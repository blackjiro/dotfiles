---
allowed-tools: Read, Write, Edit, Glob, LS
description: "要件定義書を基に統合的な設計書を作成するコマンド。基本設計と詳細設計の両方を含み、Mermaidダイアグラムを活用して視覚的にわかりやすい設計書を生成します。"
---

# 設計書作成

要件定義書を基に設計書を作成します: $ARGUMENTS

## 実行手順

### 1. 要件定義書の読み込み

まず、対象となる要件定義書を特定します：

- **引数指定あり**: $ARGUMENTSで指定されたファイル名を使用
- **引数指定なし**: `docs/requirements/`ディレクトリから最新のファイルを自動選択

要件定義書の内容を読み込み、以下の情報を抽出します：
- プロジェクト概要
- 機能要件
- 非機能要件
- 制約条件

### 2. 設計範囲の確認

要件の規模と複雑性を評価し、必要に応じて設計書の分割を提案します：

- **小規模**: 単一の統合設計書
- **中規模**: 基本設計書 + 詳細設計書
- **大規模**: モジュール別の設計書（例：フロントエンド設計書、バックエンド設計書、インフラ設計書）

分割の提案がある場合は、ユーザーに確認を求めます。

### 3. 設計範囲の決定

要件の内容に基づいて、必要な設計項目を決定します。以下は一般的な設計項目ですが、**すべてが必須ではありません**：

#### 必須項目
- **実装方針**: 技術選定、実装アプローチ
- **主要な処理フロー**: 機能の実現方法

#### オプション項目（要件に応じて選択）
- **システムアーキテクチャ**: 複数コンポーネントがある場合
- **データベース設計**: データ永続化が必要な場合
- **API設計**: 外部連携やフロントエンド分離がある場合
- **画面設計**: UIが含まれる場合
- **インフラ設計**: デプロイメントや運用が重要な場合
- **セキュリティ設計**: 認証・認可や機密データを扱う場合
- **性能設計**: パフォーマンス要件がある場合

### 4. 設計情報の収集

選択された設計項目について、詳細情報を確認します：

- 単一機能の場合は、実装に必要な最小限の情報のみ
- 大規模システムの場合は、包括的な設計情報

### 5. 深掘り検討

要件と設計規模に応じて、以下の観点から必要な項目のみを検討します：

- **実装上の課題**: 技術的な難易度、制約事項
- **将来の拡張性**: 要件で言及されている場合のみ
- **テスト方針**: 品質保証の方法

### 6. 設計書の生成

確認が完了したら、`docs/design/`ディレクトリに設計書を生成します。

**設計書の構造は要件に応じて柔軟に調整されます。**以下は参考例です：

#### 単一機能の設計書例
```markdown
# [機能名] 設計書

## 1. 概要
- 対象要件
- 実装方針

## 2. 技術仕様
- 使用技術
- 実装アプローチ

## 3. 処理設計
[Mermaid図: フローチャート]
- 処理フロー
- エラーハンドリング

## 4. テスト方針
```

#### 中規模システムの設計書例
```markdown
# [プロジェクト名] 設計書

## 1. 概要

## 2. アーキテクチャ（必要な場合）
[Mermaid図: システム構成図]

## 3. データ設計（必要な場合）
[Mermaid図: ER図]

## 4. API設計（必要な場合）

## 5. 画面設計（必要な場合）
[Mermaid図: 画面遷移図]

## 6. 実装詳細
[Mermaid図: シーケンス図]

## 7. テスト設計
```

#### 大規模システムの設計書例
```markdown
# [プロジェクト名] 設計書

## 1. 概要
### 1.1 対象要件定義書
### 1.2 設計方針

## 2. システムアーキテクチャ
[複雑なMermaid図]

## 3. 基本設計
### 3.1 データベース設計
### 3.2 API設計
### 3.3 画面設計

## 4. 詳細設計
### 4.1 モジュール設計
### 4.2 処理フロー設計

## 5. 非機能設計（必要に応じて）
### 5.1 セキュリティ設計
### 5.2 性能設計
### 5.3 運用設計

## 6. インフラ設計（必要に応じて）

## 7. 移行設計（必要に応じて）

## 8. テスト設計

## 9. 付録
```

### Mermaidダイアグラムの活用

要件に応じて、適切なMermaidダイアグラムを選択して使用します：

- **フローチャート**: `flowchart LR` - 単一機能の処理フロー
- **シーケンス図**: `sequenceDiagram` - コンポーネント間のやり取り
- **ER図**: `erDiagram` - データベース設計がある場合
- **システム構成図**: `graph TB` - 複数コンポーネントがある場合
- **クラス図**: `classDiagram` - オブジェクト指向設計の場合
- **状態遷移図**: `stateDiagram-v2` - 状態管理が複雑な場合

## 使用例

```
/design                                    # 最新の要件定義書を使用
/design 001_user_management.md            # 特定の要件定義書を指定
/design ECサイト決済機能                    # プロジェクト名で指定
```

## 注意事項

- 設計書は`docs/design/`ディレクトリに、`[連番]_[設計名].md`の形式で保存されます
- 設計書のフォーマットは要件の規模と内容に応じて自動的に調整されます
- 不要な設計項目は含めず、必要な項目のみで構成されます
- Mermaidダイアグラムは、GitHubやVSCodeなどのMarkdownビューアーで表示可能です
- 既存の設計書がある場合は、上書きするか確認します