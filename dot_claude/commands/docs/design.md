---
allowed-tools: Read, Write, Edit, Glob, LS
description: "要件定義書を基に統合的な設計書を作成するコマンド。基本設計と詳細設計の両方を含み、Mermaidダイアグラムを活用して視覚的にわかりやすい設計書を生成します。"
---

# 設計書作成

要件定義書を基に設計書を作成します: $ARGUMENTS

## 実行手順

### 1. 要件定義書の読み込み

まず、対象となる要件定義書を特定します：

- **引数指定あり**: $ARGUMENTSで指定されたファイル名を使用
- **引数指定なし**: `docs/requirements/`ディレクトリから最新のファイルを自動選択

要件定義書の内容を読み込み、以下の情報を抽出します：
- プロジェクト概要
- 機能要件
- 非機能要件
- 制約条件

### 2. 設計範囲の確認

要件の規模と複雑性を評価し、必要に応じて設計書の分割を提案します：

- **小規模**: 単一の統合設計書
- **中規模**: 基本設計書 + 詳細設計書
- **大規模**: モジュール別の設計書（例：フロントエンド設計書、バックエンド設計書、インフラ設計書）

分割の提案がある場合は、ユーザーに確認を求めます。

### 3. 基本設計情報の収集

以下の基本設計に関する情報を確認します：

#### 3.1 システムアーキテクチャ
- アーキテクチャパターン（モノリシック、マイクロサービス、サーバーレスなど）
- 技術スタック（言語、フレームワーク、ライブラリ）
- システム構成（フロントエンド、バックエンド、データベース、外部連携）

#### 3.2 データ設計
- データモデル
- データベース選定（RDB、NoSQL、NewSQLなど）
- データフロー

#### 3.3 インターフェース設計
- API設計方針（REST、GraphQL、gRPCなど）
- 画面設計方針（SPA、MPA、SSR/SSGなど）
- 外部システム連携

### 4. 詳細設計情報の収集

以下の詳細設計に関する情報を確認します：

#### 4.1 コンポーネント設計
- モジュール構成
- クラス/コンポーネント設計
- 責務の分離

#### 4.2 処理設計
- 主要な処理フロー
- エラーハンドリング
- トランザクション管理

#### 4.3 セキュリティ設計
- 認証・認可方式
- データ保護
- 通信のセキュリティ

### 5. 深掘り検討

収集した情報を基に、以下の観点で追加検討が必要な項目を洗い出します：

- **性能要件の実現方法**: キャッシング戦略、最適化方針
- **スケーラビリティ**: 負荷分散、オートスケーリング
- **可用性**: 冗長化、障害対策
- **保守性**: ログ設計、監視設計
- **テスト戦略**: テスト方針、CI/CD

### 6. 設計書の生成

確認が完了したら、`docs/design/`ディレクトリに以下の構造で設計書を生成します：

```markdown
# [プロジェクト名] 設計書

## 1. 概要
### 1.1 対象要件定義書
### 1.2 設計方針
### 1.3 前提条件

## 2. システムアーキテクチャ
### 2.1 全体構成
[Mermaid図: システム構成図]

### 2.2 技術スタック
### 2.3 デプロイメント構成
[Mermaid図: デプロイメント図]

## 3. 基本設計
### 3.1 データベース設計
#### 3.1.1 ER図
[Mermaid図: ER図]
#### 3.1.2 テーブル定義

### 3.2 API設計
#### 3.2.1 API一覧
#### 3.2.2 API仕様
[各APIの詳細]

### 3.3 画面設計
#### 3.3.1 画面遷移図
[Mermaid図: 画面遷移図]
#### 3.3.2 画面一覧

## 4. 詳細設計
### 4.1 クラス設計
[Mermaid図: クラス図]

### 4.2 シーケンス設計
[主要処理のMermaid図: シーケンス図]

### 4.3 状態遷移設計
[Mermaid図: 状態遷移図]

## 5. 非機能設計
### 5.1 セキュリティ設計
### 5.2 性能設計
### 5.3 運用設計

## 6. インフラ設計
### 6.1 ネットワーク構成
[Mermaid図: ネットワーク図]
### 6.2 サーバー構成
### 6.3 監視設計

## 7. 移行設計
### 7.1 データ移行
### 7.2 システム移行

## 8. テスト設計
### 8.1 テスト方針
### 8.2 テストケース概要

## 9. 付録
### 9.1 用語集
### 9.2 参考資料
```

### Mermaidダイアグラムの例

設計書には以下のようなMermaidダイアグラムを含めます：

- **システム構成図**: `graph TB`
- **ER図**: `erDiagram`
- **シーケンス図**: `sequenceDiagram`
- **クラス図**: `classDiagram`
- **状態遷移図**: `stateDiagram-v2`
- **フローチャート**: `flowchart LR`

## 使用例

```
/design                                    # 最新の要件定義書を使用
/design 001_user_management.md            # 特定の要件定義書を指定
/design ECサイト決済機能                    # プロジェクト名で指定
```

## 注意事項

- 設計書は`docs/design/`ディレクトリに、`[連番]_[設計名].md`の形式で保存されます
- Mermaidダイアグラムは、GitHubやVSCodeなどのMarkdownビューアーで表示可能です
- 大規模な要件の場合、複数の設計書に分割することを提案します
- 既存の設計書がある場合は、上書きするか確認します